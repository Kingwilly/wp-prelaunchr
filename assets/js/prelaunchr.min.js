jQuery( document ).ready(function( $ ) {

	var pid;
	var cookie_pid = $.cookie('prelaunchr[id]');
	var email;

	if ( cookie_pid == undefined ) {

		/**
		 * If no existing uuid generate a new uuid and set a new cookie
		 */
		pid = uuid.v4();
		$.cookie( 'prelaunchr[id]' , pid , { expires: 730, path: '/' });

	} else {

		/**
		 * Use the existing uuid
		 */
		pid = cookie_pid; 

	}

	$('.pform').submit(function(e){

		e.preventDefault();

		email = $.trim( $(this).find("input[type='email']").val() );

		$.ajax({

			type: 'POST',
			url: PrelaunchrSubmit.ajaxurl,
			data: {
				'action'	: 'prelaunchr-submit', 
				'pid'		: pid,
				'email'		: email
			},
			dataType: 'JSON',
			success: function( response, textStatus, XMLHttpRequest ) {
				console.log( response );
				if ( response.success ) {
					window.location.href = '/'+PrelaunchrSubmit.return+'/'+response.data.pid;
				}
			},
			error: function( XMLHttpRequest, textStatus, errorThrown) {
				console.log( errorThrown );
			},
			complete: function( XMLHttpRequest, textStatus) {
				//something
			}

		});

	});


});